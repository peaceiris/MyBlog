<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#ffffff"/>


<meta name="description" content="Abstract The code is here.
Thanks to Mike for reviewing this.
I have always been mildly irritated by how many .net projects I need to create in my standard workflow.
Usually I start with an idea for a library; I then want to test it with a simple executable; write some XUnit tests for it and finally benchmark some key scenarios. So I end up with at least four projects to manage.">





<link rel="preload" href="../../fonts/SourceSerifVariable-Roman.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../fonts/SourceSansVariable-Roman.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<link rel="stylesheet" href="../../css/base.css"> 
<link rel="stylesheet" href="../../css/fonts.css">


  <link rel="preload" href="../../fonts/SourceCodeVariable-Roman.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="../../fonts/SourceCodeVariable-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="../../fonts/SourceSerifVariable-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">



  <title>A single .NET Core project to rule them all | Lucabol blog</title>


<link rel="apple-touch-icon" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="manifest" href="../../site.webmanifest">
    </head>
<body>
    <header>
        <div id="topnav">
            <a id="logo" href="../../">❧</a>
            
                <time id="blog_date" > 2019/02/02</time>
            
            <span class="offline">~~ Offline ~~</span>
            <span class="rightnav">
                <a id="theme">theme</a><div class="dropdown-content">
          <a class="font-name" data-classname="OpenDyslexic" >0. OpenDyslexic</a>
          <a class="font-name" data-classname="Cardo" >1. Se Old Style: Cardo (Minion, Gallard, Centaur)</a>
          <a class="font-name" data-classname="CrimsonPro" >1. Se Old Style: Crimson Pro (Century, Palatino, Plantin, Sabon)</a>
          <a class="font-name" data-classname="EBGaramond" >1. Se Old Style: Garamond</a>
          <a class="font-name" data-classname="Gentium" >1. Se Old Style: Gentium</a>
          <a class="font-name" data-classname="GoudyStM" >1. Se Old Style: Sorts Mill Goudy</a>
          <a class="font-name" data-classname="LibreBaskerville" >4. Se Transitional: Libre Bask. (Mrs Eaves)</a>
          <a class="font-name" data-classname="LibreCaslon" >4. Se Transitional: Libre Caslon</a>
          <a class="font-name" data-classname="PT" >4. Se Transitional: PT fonts (Le Monde)</a>
          <a class="font-name" data-classname="SourcePro" >4. Se Transitional: Source Pro (Skolar, Fournier)</a>
          <a class="font-name" data-classname="TimesNewRoman" >4. Se Transitional: Times New Roman</a>
          <a class="font-name" data-classname="CM" >5. Se Didone: Computer Modern</a>
          <a class="font-name" data-classname="OldStandardTT" >5. Se Didone: Old Standard TT (Filosofia, Scotch Modern)</a>
          <a class="font-name" data-classname="STIX2" >5. Se Didone: Stix2</a>
          <a class="font-name" data-classname="Charter" >6. Se Scotch: Charter</a>
          <a class="font-name" data-classname="Georgia" >6. Se Scotch: Georgia</a>
          <a class="font-name" data-classname="WorkSans" >8. Sa Grotesque: Work Sans (All Grotesque, FF Bau, Venus)</a>
          <a class="font-name" data-classname="AntiqueOlive" >9. Sa Geometric: Antique Oliv</a>
          <a class="font-name" data-classname="bahnschrift" >9. Sa Geometric: Bahnschrift</a>
          <a class="font-name" data-classname="CooperHewitt" >9. Sa Geometric: Cooper Hewitt (Calibre)</a>
          <a class="font-name" data-classname="SourceSans" >9. Sa Humanist: Source Sans (Balto, Adelle Sans)</a>
          <a class="font-name" data-classname="URWClassico" >9. Sa Humanist: URW Classico (Optima)</a>
          <a class="font-name" data-classname="FiraSans" >a. Sa Humanist: Fira Sans (FF Meta)</a>
          <a class="font-name" data-classname="Nimbus" >a. Sa Humanist: Nimbus (Helvetica)</a>
          <a class="font-name" data-classname="Roboto" >a. Sa Humanist: Roboto (DIN</a>
          <a class="font-name" data-classname="Munson" >b. Sl Grotesque: Munson (Clarendon)</a>
          <a class="font-name" data-classname="Sanchez" >c. Sl Geometric: Sanchez (Rockwell)</a>
          <a class="font-name" data-classname="Enriqueta" >d. Sl Humanist: Enriqueta (PMN Caecilia)</a>
          <a class="font-name" data-classname="Merriweather" >d. Sl Humanist: Merriweather (Chapparal)</a>
          <a class="font-name" data-classname="profont" >Z. Sa Monospace: Profont</a>
</div>
                <a id="to_nav">Menu</a>
                <nav id="primary_nav">
                    

  <a href="../../MyBlog/">home</a>
  <a href="../../MyBlog/tags/">tags</a>
  <a href="https://www.github.com/lucabol">github</a>
  <a href="https://www.linkedin.com/in/lucabolognese/">linkdin</a>
  <a href="../../MyBlog/search">search</a>
  <a href="../../MyBlog/index.xml">rss</a>
                </nav>
            </span>
        </div>
    <h1 id="title">
    
        A single .NET Core project to rule them all
    
    </h1>

    </header>

    <main>
        

<h2 id="abstract">Abstract</h2>
<p>The code is <a href="https://github.com/lucabol/SingleSourceProject">here</a>.</p>
<p>Thanks to <a href="https://github.com/mjrousos">Mike</a> for reviewing this.</p>
<p>I have always been mildly irritated by how many .net projects I need to create in my standard workflow.</p>
<p>Usually I start with an idea for a library; I then want to test it with a simple executable; write some XUnit tests for it and finally benchmark some key scenarios. So I end up with at least four projects to manage.</p>
<p>Sure, I can find ways to automatically generate those projects, but I have always been weary of codegen to solve complexity issues. It always ends up coming back to bite you. For those of you as old as I am, think <a href="https://en.wikipedia.org/wiki/Microsoft_Foundation_Class_Library">MFC</a> &hellip;</p>
<p>So what is my ideal world then? Well, let&rsquo;s try this:</p>
<ol>
<li>One single project for the library and related artifacts (i.e. test, benchmarks, etc&hellip;).</li>
<li>Distinguish the library code from the test code from the benchmark code by some convention (i.e. name scheme).</li>
<li>Generate each artifact (i.e. library, tests, benchmarks, executable) by passing different options to <code>dotnet build</code> and <code>dotnet run</code>.</li>
<li>Create a new project by using the standard <code>dotnet new</code> syntax.</li>
<li>Have intellisense working normally in each file for my chosen editor (VSCode).</li>
<li>Work with <code>dotnet watch</code> so that one can automatically run tests when anything changes.</li>
</ol>
<h2 id="disclaimer">Disclaimer</h2>
<p>What follows, despite working fine, is not the standard way .net tools are used. It is not in the &lsquo;golden path&rsquo;. That is problematic for production usage as:</p>
<ol>
<li>It might not work in your particular configuration.</li>
<li>It might not work with other tools that rely on the presence of multiple projects (i.e. code coverage? &hellip;).</li>
<li>It might work now in all scenarios, but get broken in the future as you update to a new framework, sdk, editor.</li>
<li>It might expose bugs in the tools, now or later, which aren&rsquo;t going to be fixed, as you are not using the tools as intended.</li>
<li>It might upset your coworkers that are used to a more standard setup.</li>
</ol>
<p>I need to write a blog post about the concept of the &lsquo;golden path&rsquo; and the perils, mostly hidden, of getting away from it. The summary, it is a bad idea.</p>
<p>Having said all of that, for the daring souls, here is one way to achieve most of the above. It also works out as a tutorial on how the different components of the .NET Core build system interacts.</p>
<h2 id="how-to-use-it">How to use it</h2>
<p>Here are the steps:</p>
<ol>
<li>Type <code>dotnet new -i Lucabol.SingleSourceProject</code>.</li>
<li>Create a directory for your project and cd to it.</li>
<li>Type <code>dotnet new lsingleproject</code> and optionally <code>--standardVersion &lt;netstandardXX&gt; --appVersion &lt;netcoreappXX&gt;</code>.</li>
<li>Either modify the <code>Library.cs</code>, <code>Main.cs</code>, <code>Test.cs</code>, <code>Bench.cs</code> files or create your own with this convention:
<ul>
<li>Code for the executable goes in potentially multiple files named <code>XXXMain.cs</code> (i.e. <code>MyLibrary.Main.cs</code>).</li>
<li>Code for the tests goes into files named <code>XXXTest.cs</code> (i.e. <code>MyLibrary.Test.cs</code>).</li>
<li>Code for the benchmarks goes into files named <code>XXXBench.cs</code> (i.e. <code>MyLibrary.Bench.cs</code>).</li>
<li>Any <code>.cs</code> file not following the above conventions is compiled into the dll.</li>
</ul>
</li>
<li>Type:
<ul>
<li><code>dotnet build</code> or <code>dotnet build -c release</code> to build <code>debug</code> or <code>release</code> version of your dll. This doesn&rsquo;t include any of the main, test or bench code.</li>
<li><code>dotnet build -c main</code> or <code>dotnet build -c main_release</code> and the corresponding <code>dotnet run -c ..</code> build and run the exe.</li>
<li><code>dotnet build -c test</code>, <code>dotnet build -c test_release</code> and <code>dotnet test -c test</code> build and run the tests.</li>
<li><code>dotnet build -c bench</code>, <code>dotnet run -c bench</code> build and run the benchmark.</li>
</ul>
</li>
</ol>
<h2 id="how-it-all-works">How it all works</h2>
<p>The various steps above are implemented as follows:</p>
<p><code>dotnet new -i ...</code> install a <a href="https://docs.microsoft.com/en-us/dotnet/core/tools/custom-templates">custom template</a> that I have created and pushed on NuGet.</p>
<p>The custom template is composed of the following files:</p>
<h3 id="code-files">Code files</h3>
<p>There is one file for each kind of artifact that the project can generate: library, program, tests and benchmark. The files follow the name terminating conventions, as described above.</p>
<h3 id="project-file">Project file</h3>
<p>The project file is identical to any other project file generated by <code>dotnet new</code> except that there is one additional line appended at the end:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cs" data-lang="cs">&lt;Import Project=<span style="color:#b84">&#34;Base.targets&#34;</span> /&gt;
</code></pre></div><p>This instruct <code>msbuild</code> to include the <code>Base.targets</code> file. That file has most of the magick. I have separated it out so that you can use it unchanged in your own projects.</p>
<h3 id="basetargets">Base.targets</h3>
<p>We start by removing all the file from compilation except the ones that are used to build the library.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cs" data-lang="cs">  &lt;ItemGroup&gt;
    &lt;Compile Remove=<span style="color:#b84">&#34;**/*Bench.cs;**/*Test.cs;**/*Main.cs&#34;</span> /&gt;
  &lt;/ItemGroup&gt;
</code></pre></div><p>We then conditionally include the correct ones depending on which configuration is chosen. Please notice the last line, which instruct <code>dotnet watch</code> to watch all the <code>.cs</code> files. By default it just watches the ones in the <code>debug</code> configuration.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cs" data-lang="cs">  &lt;ItemGroup&gt;
    &lt;Compile Include=<span style="color:#b84">&#34;**/*Test.cs&#34;</span>  Condition=<span style="color:#b84">&#34;&#39;$(Configuration)&#39;==&#39;Test&#39;&#34;</span>/&gt;
    &lt;Compile Include=<span style="color:#b84">&#34;**/*Test.cs&#34;</span>  Condition=<span style="color:#b84">&#34;&#39;$(Configuration)&#39;==&#39;Test_Release&#39;&#34;</span>/&gt;
    &lt;Compile Include=<span style="color:#b84">&#34;**/*Bench.cs&#34;</span> Condition=<span style="color:#b84">&#34;&#39;$(Configuration)&#39;==&#39;Bench&#39;&#34;</span>/&gt;
    &lt;Compile Include=<span style="color:#b84">&#34;**/*Main.cs&#34;</span>  Condition=<span style="color:#b84">&#34;&#39;$(Configuration)&#39;==&#39;Main&#39;&#34;</span>/&gt;
    &lt;Compile Include=<span style="color:#b84">&#34;**/*Main.cs&#34;</span>  Condition=<span style="color:#b84">&#34;&#39;$(Configuration)&#39;==&#39;Main_Release&#39;&#34;</span>/&gt;
    &lt;Watch Include=<span style="color:#b84">&#34;**\*.cs&#34;</span> /&gt;
  &lt;/ItemGroup&gt;
</code></pre></div><p>Then we need to define the references. Depending on what you are building you need to include references to the correct NuGet packages (i.e. if you are building <code>test</code> you need the <code>xunit</code> packages). This is done below:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cs" data-lang="cs">  &lt;ItemGroup  Condition=<span style="color:#b84">&#34;&#39;$(Configuration)&#39;==&#39;Bench&#39; OR &#39;$(Configuration)&#39;==&#39;Debug&#39;&#34;</span>&gt;
    &lt;PackageReference Include=<span style="color:#b84">&#34;BenchmarkDotNet&#34;</span> Version=<span style="color:#b84">&#34;0.11.3&#34;</span> /&gt;
  &lt;/ItemGroup&gt;

  &lt;ItemGroup Condition=<span style="color:#b84">&#34;&#39;$(Configuration)&#39;==&#39;Test&#39; OR &#39;$(Configuration)&#39;==&#39;Test_Release&#39; OR &#39;$(Configuration)&#39;==&#39;Debug&#39;&#34;</span>&gt;
    &lt;PackageReference Include=<span style="color:#b84">&#34;Microsoft.NET.Test.Sdk&#34;</span> Version=<span style="color:#b84">&#34;15.9.0&#34;</span> /&gt;
    &lt;PackageReference Include=<span style="color:#b84">&#34;xunit&#34;</span> Version=<span style="color:#b84">&#34;2.4.0&#34;</span> /&gt;
    &lt;PackageReference Include=<span style="color:#b84">&#34;xunit.runner.visualstudio&#34;</span> Version=<span style="color:#b84">&#34;2.4.0&#34;</span> /&gt;
  &lt;/ItemGroup&gt;
</code></pre></div><p>One thing to notice is that most references are also included in the <code>debug</code> configuration. This is not a good thing, but it is the only way to get VSCode Intellisense to work for all the files in the solution. Apparently, IntelliSense uses whatever reference are defined for the <code>debug</code> build in <code>VsCode</code>. So <code>debug</code> is special, if you wish &hellip;</p>
<p>But that&rsquo;s not enough. When you create your own <code>MsBuild</code> configurations, you also have to replicate the properties and constants that are set in the <code>debug</code> and <code>release</code> configurations. You would like a way to inherit them, but I don&rsquo;t think it is possible.</p>
<p>It is particularly important to set the <code>TargetFramework</code> property, as it needs to be set to <code>netcoreappXXX</code> for the main, test and benchmark configurations. I give an example of the <code>Test</code> and <code>Test_release</code> configurations below. The rest is similar:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cs" data-lang="cs">  &lt;PropertyGroup Condition=<span style="color:#b84">&#34;&#39;$(Configuration)&#39;==&#39;Test&#39;&#34;</span>&gt;
    &lt;TargetFramework&gt;netcoreapp2.<span style="color:#099">1</span>&lt;/TargetFramework&gt;
    &lt;DefineConstants&gt;<span style="color:#a61717;background-color:#e3d2d2">$</span>(DefineConstants);DEBUG;TRACE;TEST&lt;/DefineConstants&gt;
    &lt;DebugSymbols&gt;<span style="font-weight:bold">true</span>&lt;/DebugSymbols&gt;
    &lt;DebugType&gt;portable&lt;/DebugType&gt;
    &lt;Optimize&gt;<span style="font-weight:bold">false</span>&lt;/Optimize&gt;
  &lt;/PropertyGroup&gt;

  &lt;PropertyGroup Condition=<span style="color:#b84">&#34;&#39;$(Configuration)&#39;==&#39;Test_Release&#39;&#34;</span>&gt;
    &lt;TargetFramework&gt;netcoreapp2.<span style="color:#099">1</span>&lt;/TargetFramework&gt;
    &lt;DefineConstants&gt;<span style="color:#a61717;background-color:#e3d2d2">$</span>(DefineConstants);RELEASE;TRACE;TEST&lt;/DefineConstants&gt;
    &lt;DebugSymbols&gt;<span style="font-weight:bold">false</span>&lt;/DebugSymbols&gt;
    &lt;DebugType&gt;portable&lt;/DebugType&gt;
    &lt;Optimize&gt;<span style="font-weight:bold">true</span>&lt;/Optimize&gt;
  &lt;/PropertyGroup&gt;
</code></pre></div><h3 id="the-templateconfigtemplatejson-file">The .template.config/template.json file</h3>
<p>This is necessary to create a <code>dotnet new</code> custom template. The only thing to notice is the two parameters <code>standardVersion</code> and <code>appVersion</code> that gives the user a way to indicate which version of the .NET Standard to use for the library and which version of the application framework to use for Main, Test and Bench.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cs" data-lang="cs">{
  <span style="color:#b84">&#34;$schema&#34;</span>: <span style="color:#b84">&#34;http://json.schemastore.org/template&#34;</span>,
  <span style="color:#b84">&#34;author&#34;</span>: <span style="color:#b84">&#34;Luca Bolognese&#34;</span>,
  <span style="color:#b84">&#34;classifications&#34;</span>: [ <span style="color:#b84">&#34;Classlib&#34;</span>, <span style="color:#b84">&#34;Console&#34;</span>, <span style="color:#b84">&#34;XUnit&#34;</span> ],
  <span style="color:#b84">&#34;identity&#34;</span>: <span style="color:#b84">&#34;Lucabol.SingleSourceProject&#34;</span>,
  <span style="color:#b84">&#34;name&#34;</span>: <span style="color:#b84">&#34;One single Project&#34;</span>,
  <span style="color:#b84">&#34;description&#34;</span>: <span style="color:#b84">&#34;One single Project for DLL, XUnit, Benchmark &amp; Main, using configurations to decide what to compile&#34;</span>,
  <span style="color:#b84">&#34;shortName&#34;</span>: <span style="color:#b84">&#34;oneproject&#34;</span>,
  <span style="color:#b84">&#34;tags&#34;</span>: {
    <span style="color:#b84">&#34;language&#34;</span>: <span style="color:#b84">&#34;C#&#34;</span>,
    <span style="color:#b84">&#34;type&#34;</span>: <span style="color:#b84">&#34;project&#34;</span>
  },
  <span style="color:#b84">&#34;preferNameDirectory&#34;</span>: <span style="font-weight:bold">true</span>,
  <span style="color:#b84">&#34;sourceName&#34;</span>: <span style="color:#b84">&#34;SingleSourceProject&#34;</span>,
  <span style="color:#b84">&#34;symbols&#34;</span>:{
    <span style="color:#b84">&#34;standardVersion&#34;</span>: {
      <span style="color:#b84">&#34;type&#34;</span>: <span style="color:#b84">&#34;parameter&#34;</span>,
      <span style="color:#b84">&#34;defaultValue&#34;</span>: <span style="color:#b84">&#34;netstandard2.0&#34;</span>,
      <span style="color:#b84">&#34;replaces&#34;</span>:<span style="color:#b84">&#34;netstandard2.0&#34;</span>
    },
    <span style="color:#b84">&#34;appVersion&#34;</span>: {
      <span style="color:#b84">&#34;type&#34;</span>: <span style="color:#b84">&#34;parameter&#34;</span>,
      <span style="color:#b84">&#34;defaultValue&#34;</span>: <span style="color:#b84">&#34;netcoreapp2.1&#34;</span>,
      <span style="color:#b84">&#34;replaces&#34;</span>:<span style="color:#b84">&#34;netcoreapp2.1&#34;</span>
    }
  }
}
</code></pre></div><h2 id="conclusion">Conclusion</h2>
<p>Now that you know how it all works, you can make an informed decision if to use it or not. As for me &hellip;</p>



  
  <div id="disqus-container">
  
    <button id="disqus-button" onclick="showComments()">Show comments</button>
    <div id="disqus-comments">
      
      
      
        <div id="disqus_thread">
        </div>
        <script type="application/javascript">
          function showComments() {
            var disqus_config = function () {
};
// Build and append comments 
var d = document;
var s = d.createElement('script');
s.async = true;
s.src = '//' + "lucabol" + '.disqus.com/embed.js';
s.setAttribute('data-timestamp', + new Date());
(d.head || d.body).appendChild(s);
            // Remove button
var disqusButton = document.getElementById('disqus-button');
disqusButton.parentNode.removeChild(disqusButton); 
// Un-hide comments
var disqusComments = document.getElementById('disqus-comments');
disqusComments.style.display = 'block'; 
          }
        </script>
      
      <noscript>Enable JavaScript to view Disqus comments.</noscript>
    </div>
  
</div>




    </main>

    <aside id="sidebar-left">
        
<div id="tags">
  <header>
    <h1>Tags</h1>
      
    <h2>¶</h2>
    
  </header>
  
    
    <nav>
      <ul>
        
            <li><a href="../../MyBlog/tags/csharp">csharp</a></li>
        
      </ul>
    </nav>
    
  
</div>

    </aside>

    <aside id="sidebar-right">
        <section id="TOC">
        
  
    <header>
        <h1>Table of contents</h1>
        <h2>¶</h2>
    </header>
    <nav id="TableOfContents">
    <ul>
        

        
        <li>
        <a href="#abstract">Abstract</a>
        

        
        </li><li>
            <a href="#disclaimer">Disclaimer</a>
        

        
        </li><li>
            <a href="#how-to-use-it">How to use it</a>
        

        
        </li><li>
            <a href="#how-it-all-works">How it all works</a>
        

        
        <ul>
                <li>
            <a href="#code-files">Code files</a>
        

        
        </li><li>
            <a href="#project-file">Project file</a>
        

        
        </li><li>
            <a href="#basetargets">Base.targets</a>
        

        
        </li><li>
            <a href="#the-templateconfigtemplatejson-file">The .template.config/template.json file</a>
        

        
        </li></ul></li><li>
            <a href="#conclusion">Conclusion</a>
    </li></ul>
</nav>


        </section>
    </aside>

    <a id="to_top" href="#top">Top</a>
    <footer>
        
    </footer>

    <script>
    const th = document.querySelector("#theme")
    th.addEventListener("click", e => {
        const x = document.querySelector(".dropdown-content")
        if (x.style.display === "block") {
            x.removeAttribute("style")
        } else {
            x.style.display = "block";
        }
    })
    const children = document.querySelectorAll(".font-name")
    const allStyles = Array.from(children).map(c => c.dataset.classname)

    const defaultStyle = "TimesNewRoman"
    const retrievedStyle = localStorage.getItem("Style")
    const style = allStyles.includes(retrievedStyle) ? retrievedStyle : defaultStyle
    document.body.className = style;

    const fontEl = document.querySelector(".dropdown-content")
    fontEl.addEventListener("click", e => {
        const el = e.target
        const style = el.dataset.classname
        document.body.className = style;
        localStorage.setItem("Style", style)
    })



</script>
    <script>
const init = () => {

    
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    
    window.ga = window.ga || ((...args) => (ga.q = ga.q || []).push(args));

    ga('create', 'UA-133194891-1', 'auto');
    ga('set', 'transport', 'beacon');
    ga('send', 'pageview');
};


window.addEventListener('load', init);
</script>
    <script>
    if("serviceWorker" in navigator){
        navigator.serviceWorker.register("/sw.js");
    }
</script>
    <script>
    window.addEventListener('offline', (e) => {
        const els = document.getElementsByClassName('offline')
        for(const el of els)
            el.classList.add("show")
        window.caches.keys().then(strikeNonCached)
    })
    window.addEventListener('online', (e) => {
        const els = document.getElementsByClassName('offline')
        for(const el of els)
            el.classList.remove("show")

        const as = document.querySelectorAll('main a')
        for(const a of as)
            a.classList.remove('strike')
    })

    const strikeNonCached = cacheKeys => {
        caches.open(cacheKeys[0]).then(cache =>
            cache.keys().then(keys => {
                const as = document.querySelectorAll('main a')
                const urls = keys.map(k => k.url)
                for(const a of as)
                    if(urls.indexOf(a.href) === -1)    
                        a.classList.add('strike')
    }))}

    if(navigator.onLine)
        window.dispatchEvent(new Event('online'))
    else
        window.dispatchEvent(new Event('offline'))

</script>
    <script>
function variableResize() {

  
  let bodyStyles = window.getComputedStyle(document.body);	
	
  let root = document.documentElement;
	
	
	const maxWindowSize = bodyStyles.getPropertyValue('--bp-xlarge') * 16;
	const minWindowSize = bodyStyles.getPropertyValue('--bp-small') * 16;
	
	
	const windowWidth = window.innerWidth
	
  
  const pWidthVar = '--p-wdth';
	const pMinFontWidth = bodyStyles.getPropertyValue('--p-wdth-min');
	const pMaxFontWidth = bodyStyles.getPropertyValue('--p-wdth-max');
	scale(pWidthVar, pMinFontWidth, pMaxFontWidth);

  const pWeightVar = '--p-wght';
	const pMinFontWeight = bodyStyles.getPropertyValue('--p-wght-min');
	const pMaxFontWeight = bodyStyles.getPropertyValue('--p-wght-max');
	scale(pWeightVar, pMinFontWeight, pMaxFontWeight);
	
  const h1WidthVar = '--h1-wdth';
	const h1MinFontWidth = bodyStyles.getPropertyValue('--h1-wdth-min');
	const h1MaxFontWidth = bodyStyles.getPropertyValue('--h1-wdth-max');
	scale(h1WidthVar, h1MinFontWidth, h1MaxFontWidth);

  const h1WeightVar = '--h1-wght';
	const h1MinFontWeight = bodyStyles.getPropertyValue('--h1-wght-min');
	const h1MaxFontWeight = bodyStyles.getPropertyValue('--h1-wght-max');
	scale(h1WeightVar, h1MinFontWeight, h1MaxFontWeight);
	
  const h2WidthVar = '--h2-wdth';
	const h2MinFontWidth = bodyStyles.getPropertyValue('--h2-wdth-min');
	const h2MaxFontWidth = bodyStyles.getPropertyValue('--h2-wdth-max');
	scale(h2WidthVar, h2MinFontWidth, h2MaxFontWidth);

  const h2WeightVar = '--h2-wght';
	const h2MinFontWeight = bodyStyles.getPropertyValue('--h2-wght-min');
	const h2MaxFontWeight = bodyStyles.getPropertyValue('--h2-wght-max');
	scale(h2WeightVar, h2MinFontWeight, h2MaxFontWeight);
	
	function scale(varName, minValue, maxValue) {
		
		minValue = minValue * 1;
		maxValue = maxValue * 1;

		
		const percent = (windowWidth - minWindowSize) / (maxWindowSize - minWindowSize);
		if (maxValue < minValue) {
			var valueScale = minValue - (percent * (minValue - maxValue));
		} else {
			var valueScale = (percent * (maxValue - minValue)) + minValue;
		}
	  
		
		const newValue = windowWidth > maxWindowSize
		   ? maxValue 
		   : windowWidth < minWindowSize 
				? minValue 
				: valueScale;
	   
		
		root.style.setProperty(varName, newValue);
	}
}

window.addEventListener("load", variableResize);
window.addEventListener("resize", variableResize);

</script>
    <script>
  const el = document.querySelector("#to_nav")
  el.addEventListener("click", e => {
    const x = document.querySelector("#primary_nav")
    if (x.style.display === "block") {
      x.removeAttribute("style")
    } else {
      x.style.display = "block";
    }
  })
  window.addEventListener('click', e => {
    const x = document.querySelector("#primary_nav")
    const y = document.querySelector("#to_nav")
    if (!y.contains(e.target) && x.style.display === "block") {
      x.removeAttribute("style")
    } 

    const th = document.querySelector("#theme")
    const x1 = document.querySelector(".dropdown-content")

    if (!th.contains(e.target) && ! x1.contains(e.target) && x1.style.display === "block") {
      x1.removeAttribute("style")
    } 
  })
</script>

</body>
</html>