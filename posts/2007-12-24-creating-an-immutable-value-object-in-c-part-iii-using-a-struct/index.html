<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#ffffff"/>


<meta name="description" content="Other posts:
  Part I - Using a class
 Part II - Making the class better Part IV - A class with a special value{.} In Part II I talked about the asymmetry created by using ‘null&amp;rsquo; as the special value for our little DateSpan domain. We also noticed the boredom of having to implement Equals, GetHashCode, ‘==&amp;rsquo; and ‘!=&amp;rsquo; for our value objects. Let&amp;rsquo;s see if structs solve our problem.">





<link rel="preload" href="../../fonts/SourceSerifVariable-Roman.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../fonts/SourceSansVariable-Roman.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<link rel="stylesheet" href="../../css/base.css"> 
<link rel="stylesheet" href="../../css/fonts.css">


  <link rel="preload" href="../../fonts/SourceCodeVariable-Roman.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="../../fonts/SourceCodeVariable-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="../../fonts/SourceSerifVariable-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">



  <title>Creating an immutable value object in C#  - Part III  - Using a struct | Lucabol blog</title>


<link rel="apple-touch-icon" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="manifest" href="../../site.webmanifest">
    </head>
<body>
    <header>
        <div id="topnav">
            <a id="logo" href="../../">❧</a>
            
                <time id="blog_date" > 2007/12/12</time>
            
            <span class="offline">~~ Offline ~~</span>
            <span class="rightnav">
                <a id="theme">theme</a><div class="dropdown-content">
          <a class="font-name" data-classname="OpenDyslexic" >0. OpenDyslexic</a>
          <a class="font-name" data-classname="Cardo" >1. Se Old Style: Cardo (Minion, Gallard, Centaur)</a>
          <a class="font-name" data-classname="CrimsonPro" >1. Se Old Style: Crimson Pro (Century, Palatino, Plantin, Sabon)</a>
          <a class="font-name" data-classname="EBGaramond" >1. Se Old Style: Garamond</a>
          <a class="font-name" data-classname="Gentium" >1. Se Old Style: Gentium</a>
          <a class="font-name" data-classname="GoudyStM" >1. Se Old Style: Sorts Mill Goudy</a>
          <a class="font-name" data-classname="LibreBaskerville" >4. Se Transitional: Libre Bask. (Mrs Eaves)</a>
          <a class="font-name" data-classname="LibreCaslon" >4. Se Transitional: Libre Caslon</a>
          <a class="font-name" data-classname="PT" >4. Se Transitional: PT fonts (Le Monde)</a>
          <a class="font-name" data-classname="SourcePro" >4. Se Transitional: Source Pro (Skolar, Fournier)</a>
          <a class="font-name" data-classname="TimesNewRoman" >4. Se Transitional: Times New Roman</a>
          <a class="font-name" data-classname="CM" >5. Se Didone: Computer Modern</a>
          <a class="font-name" data-classname="OldStandardTT" >5. Se Didone: Old Standard TT (Filosofia, Scotch Modern)</a>
          <a class="font-name" data-classname="STIX2" >5. Se Didone: Stix2</a>
          <a class="font-name" data-classname="Charter" >6. Se Scotch: Charter</a>
          <a class="font-name" data-classname="Georgia" >6. Se Scotch: Georgia</a>
          <a class="font-name" data-classname="WorkSans" >8. Sa Grotesque: Work Sans (All Grotesque, FF Bau, Venus)</a>
          <a class="font-name" data-classname="AntiqueOlive" >9. Sa Geometric: Antique Oliv</a>
          <a class="font-name" data-classname="bahnschrift" >9. Sa Geometric: Bahnschrift</a>
          <a class="font-name" data-classname="CooperHewitt" >9. Sa Geometric: Cooper Hewitt (Calibre)</a>
          <a class="font-name" data-classname="SourceSans" >9. Sa Humanist: Source Sans (Balto, Adelle Sans)</a>
          <a class="font-name" data-classname="URWClassico" >9. Sa Humanist: URW Classico (Optima)</a>
          <a class="font-name" data-classname="FiraSans" >a. Sa Humanist: Fira Sans (FF Meta)</a>
          <a class="font-name" data-classname="Nimbus" >a. Sa Humanist: Nimbus (Helvetica)</a>
          <a class="font-name" data-classname="Roboto" >a. Sa Humanist: Roboto (DIN</a>
          <a class="font-name" data-classname="Munson" >b. Sl Grotesque: Munson (Clarendon)</a>
          <a class="font-name" data-classname="Sanchez" >c. Sl Geometric: Sanchez (Rockwell)</a>
          <a class="font-name" data-classname="Enriqueta" >d. Sl Humanist: Enriqueta (PMN Caecilia)</a>
          <a class="font-name" data-classname="Merriweather" >d. Sl Humanist: Merriweather (Chapparal)</a>
          <a class="font-name" data-classname="profont" >Z. Sa Monospace: Profont</a>
</div>
                <a id="to_nav">Menu</a>
                <nav id="primary_nav">
                    

  <a href="../../MyBlog/">home</a>
  <a href="../../MyBlog/tags/">tags</a>
  <a href="https://www.github.com/lucabol">github</a>
  <a href="https://www.linkedin.com/in/lucabolognese/">linkdin</a>
  <a href="../../MyBlog/search">search</a>
  <a href="../../MyBlog/index.xml">rss</a>
                </nav>
            </span>
        </div>
    <h1 id="title">
    
        Creating an immutable value object in C#  - Part III  - Using a struct
    
    </h1>

    </header>

    <main>
        

<p>Other posts:</p>
<ul>
<li>
<p><a href="http://blogs.msdn.com/lucabol/archive/2007/12/03/creating-an-immutable-value-object-in-c-part-i-using-a-class.aspx">Part I  - Using a class</a></p>
<ul>
<li><a href="http://blogs.msdn.com/lucabol/archive/2007/12/06/creating-an-immutable-value-object-in-c-part-ii-making-the-class-better.aspx">Part II  - Making the class better</a></li>
<li><a href="http://blogs.msdn.com/lucabol/">Part IV  - A class with a special value</a>{.}</ul>
In Part II I talked about the asymmetry created by using ‘null&rsquo; as the special value for our little DateSpan domain. We also noticed the boredom of having to implement Equals, GetHashCode, ‘==&rsquo; and ‘!=&rsquo; for our value objects. Let&rsquo;s see if structs solve our problem.</li>
</ul>
<p>Well, to the untrained eye they do. Structs cannot be null and they implement Equals and GetHashCode by checking the state of the object, not its pointer in memory.</p>
<p>So, have we found the perfect tool to implement our value object?</p>
<p>Unfortunately, no. Here is why a struct is a less than optimal way to implement a value object:</p>
<ol>
<li><u>Convenience issues</u>  - it is not as convenient as it looks
<ol>
<li>You still have to implement ‘==&rsquo; and ‘!=&rsquo;.
<ul>
<li>You still want to implement Equals() and GetHashCode(), if you want to avoid boxing/unboxing.</ol></li>
<li><u>Performance issues</u>  - it is not as fast as it looks
<ol>
<li>Structs are allocated on the stack. Every time you pass them as arguments, the state is copied. If your struct has more than a few fields, performance might suffer</li>
</ol>
<ul>
<li>
<p><u>Usability issues</u>  - it is not as useful as it looks.</p>
<ol>
<li>Structs always have a public default constructor that ‘zeros&rsquo; all the fields
<ul>
<li>Structs cannot be abstract
<ul>
<li>Structs cannot extend another structs</ol> </ol>
Don&rsquo;t get me wrong, structs are extremely useful as a way to represent small bundles of data. But if you use value objects extensively, their limitations start to show.</li>
</ul>
</li>
</ul>
</li>
</ol>
<pre><code>A case could be made that you should use struct to implement value objects if the issues exposed above don't apply to your case. When they do apply, you should use classes. I'm a forgetful and lazy programmer, I don't want to remember all these cases. I just want a pattern that I can use whenever I need a value object. It seems to me that structs don't fit the bill.
                    
For the sake of completeness, here is the code for DateSpan using a struct. Note that I explicitly introduced a &amp;#8216;special value' instead of using null (which is not available for structs).
                    
&lt;pre class=&quot;code&quot;&gt;&lt;span style=&quot;color:rgb(0,0,255);&quot;&gt;using&lt;/span&gt; System;
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
</ol>
</li>
</ul>
<p><span style="color:rgb(0,0,255);">using</span> System.Collections.Generic;
<span style="color:rgb(0,0,255);">using</span> System.Linq;
<span style="color:rgb(0,0,255);">using</span> System.Text;
<span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">struct</span> <span style="color:rgb(43,145,175);">DateSpan</span> {
<span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">static</span> <span style="color:rgb(43,145,175);">DateSpan</span> NoValueDateSpan { <span style="color:rgb(0,0,255);">get</span> { <span style="color:rgb(0,0,255);">return</span> noValueDateSpan; } }
<span style="color:rgb(0,0,255);">public</span> DateSpan(<span style="color:rgb(43,145,175);">DateTime</span> pstart, <span style="color:rgb(43,145,175);">DateTime</span> pend) {
<span style="color:rgb(0,0,255);">if</span> (pend &lt; pstart)
<span style="color:rgb(0,0,255);">throw</span> <span style="color:rgb(0,0,255);">new</span> <span style="color:rgb(43,145,175);">ArgumentException</span>(pstart.ToString() + <span style="color:rgb(163,21,21);">&rdquo; doesn&rsquo;t come before &ldquo;</span> + pend.ToString());
start = pstart;
end = pend;
hasValue = <span style="color:rgb(0,0,255);">true</span>;
}
<span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(43,145,175);">DateSpan</span> Union(<span style="color:rgb(43,145,175);">DateSpan</span> other) {
<span style="color:rgb(0,0,255);">if</span> (!HasValue)
<span style="color:rgb(0,0,255);">return</span> other;
<span style="color:rgb(0,0,255);">if</span> (!other.HasValue)
<span style="color:rgb(0,0,255);">return</span> <span style="color:rgb(0,0,255);">this</span>;
<span style="color:rgb(0,0,255);">if</span> (IsOutside(other))
<span style="color:rgb(0,0,255);">return</span> <span style="color:rgb(43,145,175);">DateSpan</span>.NoValueDateSpan;
<span style="color:rgb(43,145,175);">DateTime</span> newStart = other.Start &lt; Start ? other.Start : Start;
<span style="color:rgb(43,145,175);">DateTime</span> newEnd = other.End &gt; End ? other.End : End;
<span style="color:rgb(0,0,255);">return</span> <span style="color:rgb(0,0,255);">new</span> <span style="color:rgb(43,145,175);">DateSpan</span>(newStart, newEnd);
}
<span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(43,145,175);">DateSpan</span> Intersect(<span style="color:rgb(43,145,175);">DateSpan</span> other) {
<span style="color:rgb(0,0,255);">if</span> (!HasValue)
<span style="color:rgb(0,0,255);">return</span> <span style="color:rgb(43,145,175);">DateSpan</span>.NoValueDateSpan;
<span style="color:rgb(0,0,255);">if</span> (!other.HasValue)
<span style="color:rgb(0,0,255);">return</span> <span style="color:rgb(43,145,175);">DateSpan</span>.NoValueDateSpan;
<span style="color:rgb(0,0,255);">if</span> (IsOutside(other))
<span style="color:rgb(0,0,255);">return</span> <span style="color:rgb(43,145,175);">DateSpan</span>.NoValueDateSpan;
<span style="color:rgb(43,145,175);">DateTime</span> newStart = other.Start &gt; Start ? other.Start : Start;
<span style="color:rgb(43,145,175);">DateTime</span> newEnd = other.End &lt; End ? other.End : End;
<span style="color:rgb(0,0,255);">return</span> <span style="color:rgb(0,0,255);">new</span> <span style="color:rgb(43,145,175);">DateSpan</span>(newStart, newEnd);
}
<span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(43,145,175);">DateTime</span> Start { <span style="color:rgb(0,0,255);">get</span> { <span style="color:rgb(0,0,255);">return</span> start; } }
<span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(43,145,175);">DateTime</span> End { <span style="color:rgb(0,0,255);">get</span> { <span style="color:rgb(0,0,255);">return</span> end; } }
<span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">bool</span> HasValue { <span style="color:rgb(0,0,255);">get</span> { <span style="color:rgb(0,0,255);">return</span> hasValue; } }
<span style="color:rgb(0,128,0);">// Making field explicitely readonly (but cannot use autoproperties)
</span>    <span style="color:rgb(0,128,0);">// BTW: If you want to use autoproperties, given that it is a struct,
</span>    <span style="color:rgb(0,128,0);">// you need to add :this() to the constructor
</span>    <span style="color:rgb(0,0,255);">private</span> <span style="color:rgb(0,0,255);">readonly</span> <span style="color:rgb(43,145,175);">DateTime</span> start;
<span style="color:rgb(0,0,255);">private</span> <span style="color:rgb(0,0,255);">readonly</span> <span style="color:rgb(43,145,175);">DateTime</span> end;
<span style="color:rgb(0,0,255);">private</span> <span style="color:rgb(0,0,255);">readonly</span> <span style="color:rgb(0,0,255);">bool</span> hasValue;
<span style="color:rgb(0,0,255);">private</span> <span style="color:rgb(0,0,255);">bool</span> IsOutside(<span style="color:rgb(43,145,175);">DateSpan</span> other) {
<span style="color:rgb(0,0,255);">return</span> other.start &gt; end || other.end &lt; start;
}
<span style="color:rgb(0,128,0);">// Changing the internal machinery so that hasValue default is false
</span>    <span style="color:rgb(0,128,0);">// This way the automatically generated empty constructor returns the right thing
</span>    <span style="color:rgb(0,0,255);">private</span> <span style="color:rgb(0,0,255);">static</span> <span style="color:rgb(43,145,175);">DateSpan</span> noValueDateSpan = <span style="color:rgb(0,0,255);">new</span> <span style="color:rgb(43,145,175);">DateSpan</span>();
<span style="color:rgb(0,0,255);">    #region</span> Boilerplate Equals, ToString Implementation
<span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">override</span> <span style="color:rgb(0,0,255);">string</span> ToString() {
<span style="color:rgb(0,0,255);">return</span> <span style="color:rgb(0,0,255);">string</span>.Format(<span style="color:rgb(163,21,21);">&quot;Start:{0} End:{1}&ldquo;</span>, start, end);
}
<span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">static</span> <span style="color:rgb(43,145,175);">Boolean</span> <span style="color:rgb(0,0,255);">operator</span> ==(<span style="color:rgb(43,145,175);">DateSpan</span> v1, <span style="color:rgb(43,145,175);">DateSpan</span> v2) {
<span style="color:rgb(0,0,255);">return</span> (v1.Equals(v2));
}
<span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(0,0,255);">static</span> <span style="color:rgb(43,145,175);">Boolean</span> <span style="color:rgb(0,0,255);">operator</span> !=(<span style="color:rgb(43,145,175);">DateSpan</span> v1, <span style="color:rgb(43,145,175);">DateSpan</span> v2) {
<span style="color:rgb(0,0,255);">return</span> !(v1 == v2);
}
<span style="color:rgb(0,128,0);">//public override bool Equals(object obj) {
</span>    <span style="color:rgb(0,128,0);">//    if (this.GetType() != obj.GetType()) return false;
</span>    <span style="color:rgb(0,128,0);">//    DateSpan other = (DateSpan) obj;
</span>    <span style="color:rgb(0,128,0);">//    return other.end == end &amp;&amp; other.start == start;
</span>    <span style="color:rgb(0,128,0);">//}
</span>    <span style="color:rgb(0,128,0);">//public override int GetHashCode() {
</span>    <span style="color:rgb(0,128,0);">//    return start.GetHashCode() | end.GetHashCode();
</span>    <span style="color:rgb(0,128,0);">//}
</span><span style="color:rgb(0,0,255);">    #endregion
</span>}
</pre></p>
<pre><code>                    [TimeLineAsStruct.zip](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Components.PostAttachments/00/06/85/58/26/TimeLineAsStruct.zip)</code></pre>



  
  <div id="disqus-container">
  
    <button id="disqus-button" onclick="showComments()">Show comments</button>
    <div id="disqus-comments">
      
      
      
        <div id="disqus_thread">
        </div>
        <script type="application/javascript">
          function showComments() {
            var disqus_config = function () {
};
// Build and append comments 
var d = document;
var s = d.createElement('script');
s.async = true;
s.src = '//' + "lucabol" + '.disqus.com/embed.js';
s.setAttribute('data-timestamp', + new Date());
(d.head || d.body).appendChild(s);
            // Remove button
var disqusButton = document.getElementById('disqus-button');
disqusButton.parentNode.removeChild(disqusButton); 
// Un-hide comments
var disqusComments = document.getElementById('disqus-comments');
disqusComments.style.display = 'block'; 
          }
        </script>
      
      <noscript>Enable JavaScript to view Disqus comments.</noscript>
    </div>
  
</div>




    </main>

    <aside id="sidebar-left">
        
<div id="tags">
  <header>
    <h1>Tags</h1>
      
    <h2>¶</h2>
    
  </header>
  
    
    <nav>
      <ul>
        
            <li><a href="../../MyBlog/tags/csharp">csharp</a></li>
        
      </ul>
    </nav>
    
  
</div>

    </aside>

    <aside id="sidebar-right">
        <section id="TOC">
        
  
    <header>
        <h1>Table of contents</h1>
        <h2>¶</h2>
    </header>
    


        </section>
    </aside>

    <a id="to_top" href="#top">Top</a>
    <footer>
        
    </footer>

    <script>
    const th = document.querySelector("#theme")
    th.addEventListener("click", e => {
        const x = document.querySelector(".dropdown-content")
        if (x.style.display === "block") {
            x.removeAttribute("style")
        } else {
            x.style.display = "block";
        }
    })
    const children = document.querySelectorAll(".font-name")
    const allStyles = Array.from(children).map(c => c.dataset.classname)

    const defaultStyle = "TimesNewRoman"
    const retrievedStyle = localStorage.getItem("Style")
    const style = allStyles.includes(retrievedStyle) ? retrievedStyle : defaultStyle
    document.body.className = style;

    const fontEl = document.querySelector(".dropdown-content")
    fontEl.addEventListener("click", e => {
        const el = e.target
        const style = el.dataset.classname
        document.body.className = style;
        localStorage.setItem("Style", style)
    })



</script>
    <script>
const init = () => {

    
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    
    window.ga = window.ga || ((...args) => (ga.q = ga.q || []).push(args));

    ga('create', 'UA-133194891-1', 'auto');
    ga('set', 'transport', 'beacon');
    ga('send', 'pageview');
};


window.addEventListener('load', init);
</script>
    <script>
    if("serviceWorker" in navigator){
        navigator.serviceWorker.register("/sw.js");
    }
</script>
    <script>
    window.addEventListener('offline', (e) => {
        const els = document.getElementsByClassName('offline')
        for(const el of els)
            el.classList.add("show")
        window.caches.keys().then(strikeNonCached)
    })
    window.addEventListener('online', (e) => {
        const els = document.getElementsByClassName('offline')
        for(const el of els)
            el.classList.remove("show")

        const as = document.querySelectorAll('main a')
        for(const a of as)
            a.classList.remove('strike')
    })

    const strikeNonCached = cacheKeys => {
        caches.open(cacheKeys[0]).then(cache =>
            cache.keys().then(keys => {
                const as = document.querySelectorAll('main a')
                const urls = keys.map(k => k.url)
                for(const a of as)
                    if(urls.indexOf(a.href) === -1)    
                        a.classList.add('strike')
    }))}

    if(navigator.onLine)
        window.dispatchEvent(new Event('online'))
    else
        window.dispatchEvent(new Event('offline'))

</script>
    <script>
function variableResize() {

  
  let bodyStyles = window.getComputedStyle(document.body);	
	
  let root = document.documentElement;
	
	
	const maxWindowSize = bodyStyles.getPropertyValue('--bp-xlarge') * 16;
	const minWindowSize = bodyStyles.getPropertyValue('--bp-small') * 16;
	
	
	const windowWidth = window.innerWidth
	
  
  const pWidthVar = '--p-wdth';
	const pMinFontWidth = bodyStyles.getPropertyValue('--p-wdth-min');
	const pMaxFontWidth = bodyStyles.getPropertyValue('--p-wdth-max');
	scale(pWidthVar, pMinFontWidth, pMaxFontWidth);

  const pWeightVar = '--p-wght';
	const pMinFontWeight = bodyStyles.getPropertyValue('--p-wght-min');
	const pMaxFontWeight = bodyStyles.getPropertyValue('--p-wght-max');
	scale(pWeightVar, pMinFontWeight, pMaxFontWeight);
	
  const h1WidthVar = '--h1-wdth';
	const h1MinFontWidth = bodyStyles.getPropertyValue('--h1-wdth-min');
	const h1MaxFontWidth = bodyStyles.getPropertyValue('--h1-wdth-max');
	scale(h1WidthVar, h1MinFontWidth, h1MaxFontWidth);

  const h1WeightVar = '--h1-wght';
	const h1MinFontWeight = bodyStyles.getPropertyValue('--h1-wght-min');
	const h1MaxFontWeight = bodyStyles.getPropertyValue('--h1-wght-max');
	scale(h1WeightVar, h1MinFontWeight, h1MaxFontWeight);
	
  const h2WidthVar = '--h2-wdth';
	const h2MinFontWidth = bodyStyles.getPropertyValue('--h2-wdth-min');
	const h2MaxFontWidth = bodyStyles.getPropertyValue('--h2-wdth-max');
	scale(h2WidthVar, h2MinFontWidth, h2MaxFontWidth);

  const h2WeightVar = '--h2-wght';
	const h2MinFontWeight = bodyStyles.getPropertyValue('--h2-wght-min');
	const h2MaxFontWeight = bodyStyles.getPropertyValue('--h2-wght-max');
	scale(h2WeightVar, h2MinFontWeight, h2MaxFontWeight);
	
	function scale(varName, minValue, maxValue) {
		
		minValue = minValue * 1;
		maxValue = maxValue * 1;

		
		const percent = (windowWidth - minWindowSize) / (maxWindowSize - minWindowSize);
		if (maxValue < minValue) {
			var valueScale = minValue - (percent * (minValue - maxValue));
		} else {
			var valueScale = (percent * (maxValue - minValue)) + minValue;
		}
	  
		
		const newValue = windowWidth > maxWindowSize
		   ? maxValue 
		   : windowWidth < minWindowSize 
				? minValue 
				: valueScale;
	   
		
		root.style.setProperty(varName, newValue);
	}
}

window.addEventListener("load", variableResize);
window.addEventListener("resize", variableResize);

</script>
    <script>
  const el = document.querySelector("#to_nav")
  el.addEventListener("click", e => {
    const x = document.querySelector("#primary_nav")
    if (x.style.display === "block") {
      x.removeAttribute("style")
    } else {
      x.style.display = "block";
    }
  })
  window.addEventListener('click', e => {
    const x = document.querySelector("#primary_nav")
    const y = document.querySelector("#to_nav")
    if (!y.contains(e.target) && x.style.display === "block") {
      x.removeAttribute("style")
    } 

    const th = document.querySelector("#theme")
    const x1 = document.querySelector(".dropdown-content")

    if (!th.contains(e.target) && ! x1.contains(e.target) && x1.style.display === "block") {
      x1.removeAttribute("style")
    } 
  })
</script>

</body>
</html>