<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#ffffff"/>


<meta name="description" content="I wanted to experiment with MVVM and WPF in F#, so I decided to create a little graphical interface for the csv file that drives the spread tracking application. When I started I thought I needed some kind of a grid with Submit/Cancel buttons, but the more I thought about it, the more I realized that I wouldn’t need them.
See, I’ve always be one to complain about our current paradigm of Open File / Close File / Save File arguing that the user shouldn’t know about an entity called ‘file’.">





<link rel="preload" href="../../fonts/SourceSerifVariable-Roman.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../fonts/SourceSansVariable-Roman.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<link rel="stylesheet" href="../../css/base.css"> 
<link rel="stylesheet" href="../../css/fonts.css">


  <link rel="preload" href="../../fonts/SourceCodeVariable-Roman.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="../../fonts/SourceCodeVariable-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="../../fonts/SourceSerifVariable-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">



  <title>Tracking spread trades in F# (and WPF MVVM) – Part II | Lucabol blog</title>


<link rel="apple-touch-icon" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="manifest" href="../../site.webmanifest">
    </head>
<body>
    <header>
        <div id="topnav">
            <a id="logo" href="../../">❧</a>
            
                <time id="blog_date" > 2010/03/03</time>
            
            <span class="offline">~~ Offline ~~</span>
            <span class="rightnav">
                <a id="theme">theme</a><div class="dropdown-content">
          <a class="font-name" data-classname="OpenDyslexic" >0. OpenDyslexic</a>
          <a class="font-name" data-classname="Cardo" >1. Se Old Style: Cardo (Minion, Gallard, Centaur)</a>
          <a class="font-name" data-classname="CrimsonPro" >1. Se Old Style: Crimson Pro (Century, Palatino, Plantin, Sabon)</a>
          <a class="font-name" data-classname="EBGaramond" >1. Se Old Style: Garamond</a>
          <a class="font-name" data-classname="Gentium" >1. Se Old Style: Gentium</a>
          <a class="font-name" data-classname="GoudyStM" >1. Se Old Style: Sorts Mill Goudy</a>
          <a class="font-name" data-classname="LibreBaskerville" >4. Se Transitional: Libre Bask. (Mrs Eaves)</a>
          <a class="font-name" data-classname="LibreCaslon" >4. Se Transitional: Libre Caslon</a>
          <a class="font-name" data-classname="PT" >4. Se Transitional: PT fonts (Le Monde)</a>
          <a class="font-name" data-classname="SourcePro" >4. Se Transitional: Source Pro (Skolar, Fournier)</a>
          <a class="font-name" data-classname="TimesNewRoman" >4. Se Transitional: Times New Roman</a>
          <a class="font-name" data-classname="CM" >5. Se Didone: Computer Modern</a>
          <a class="font-name" data-classname="OldStandardTT" >5. Se Didone: Old Standard TT (Filosofia, Scotch Modern)</a>
          <a class="font-name" data-classname="STIX2" >5. Se Didone: Stix2</a>
          <a class="font-name" data-classname="Charter" >6. Se Scotch: Charter</a>
          <a class="font-name" data-classname="Georgia" >6. Se Scotch: Georgia</a>
          <a class="font-name" data-classname="WorkSans" >8. Sa Grotesque: Work Sans (All Grotesque, FF Bau, Venus)</a>
          <a class="font-name" data-classname="AntiqueOlive" >9. Sa Geometric: Antique Oliv</a>
          <a class="font-name" data-classname="bahnschrift" >9. Sa Geometric: Bahnschrift</a>
          <a class="font-name" data-classname="CooperHewitt" >9. Sa Geometric: Cooper Hewitt (Calibre)</a>
          <a class="font-name" data-classname="SourceSans" >9. Sa Humanist: Source Sans (Balto, Adelle Sans)</a>
          <a class="font-name" data-classname="URWClassico" >9. Sa Humanist: URW Classico (Optima)</a>
          <a class="font-name" data-classname="FiraSans" >a. Sa Humanist: Fira Sans (FF Meta)</a>
          <a class="font-name" data-classname="Nimbus" >a. Sa Humanist: Nimbus (Helvetica)</a>
          <a class="font-name" data-classname="Roboto" >a. Sa Humanist: Roboto (DIN</a>
          <a class="font-name" data-classname="Munson" >b. Sl Grotesque: Munson (Clarendon)</a>
          <a class="font-name" data-classname="Sanchez" >c. Sl Geometric: Sanchez (Rockwell)</a>
          <a class="font-name" data-classname="Enriqueta" >d. Sl Humanist: Enriqueta (PMN Caecilia)</a>
          <a class="font-name" data-classname="Merriweather" >d. Sl Humanist: Merriweather (Chapparal)</a>
          <a class="font-name" data-classname="profont" >Z. Sa Monospace: Profont</a>
</div>
                <a id="to_nav">Menu</a>
                <nav id="primary_nav">
                    

  <a href="../../MyBlog/">home</a>
  <a href="../../MyBlog/tags/">tags</a>
  <a href="https://www.github.com/lucabol">github</a>
  <a href="https://www.linkedin.com/in/lucabolognese/">linkdin</a>
  <a href="../../MyBlog/search">search</a>
  <a href="../../MyBlog/index.xml">rss</a>
                </nav>
            </span>
        </div>
    <h1 id="title">
    
        Tracking spread trades in F# (and WPF MVVM) – Part II
    
    </h1>

    </header>

    <main>
        

<p>I wanted to experiment with MVVM and WPF in F#, so I decided to create a little graphical interface for the csv file that drives the spread tracking application. When I started I thought I needed some kind of a grid with Submit/Cancel buttons, but the more I thought about it, the more I realized that I wouldn’t need them.</p>
<p>See, I’ve always be one to complain about our current paradigm of Open File / Close File / Save File arguing that the user shouldn’t know about an entity called ‘file’. He shouldn’t be exposed to the fact that the application is just an in-memory copy of an hard disk artifact. His mental model should simply be: I open a document, I work on it, I close it, if needed I can make a copy; if I have problems I can revert to a previous version of the same document; If I make an error I can use ‘undo’ to revert it. There are no files/save/submit/cancel in such paradigm. There is no file system.</p>
<p>On the technical side I wanted to experiment with MVVM, even if in this case, the paradigm is overkilled (can really use this word?), given the simplicity of the application.</p>
<p>In any case, the ViewModel is in F#. It uses two utility classes:</p>
<pre class="code"><span style="color:green;">// TODO: refactor to remove code repetition below
</span>[&lt;AbstractClass&gt;]
<span style="color:blue;">type </span>ViewModelBase () =
    <span style="color:blue;">let </span>propertyChanged = <span style="color:blue;">new </span>Event&lt;PropertyChangedEventHandler, PropertyChangedEventArgs&gt;()
    <span style="color:blue;">interface </span>INotifyPropertyChanged <span style="color:blue;">with
        </span>[&lt;CLIEvent&gt;]
        <span style="color:blue;">member </span>this.PropertyChanged = propertyChanged.Publish
    <span style="color:blue;">member internal </span>this.RaisePropertyChangedEvent(propertyName:string) =
        <span style="color:blue;">if </span>not(propertyName = <span style="color:blue;">null</span>) <span style="color:blue;">then
            let </span>e = <span style="color:blue;">new </span>PropertyChangedEventArgs(propertyName)
            <span style="color:blue;">let </span>i = this :&gt; INotifyPropertyChanged
            propertyChanged.Trigger(this, e)
<span style="color:blue;">type </span>ObservableCollectionWithChanges&lt;'a <span style="color:blue;">when </span>'a :&gt; INotifyPropertyChanged&gt; () =
    <span style="color:blue;">inherit </span>ObservableCollection&lt;'a&gt; ()
    <span style="color:blue;">let </span>propertyChanged = <span style="color:blue;">new </span>Event&lt;PropertyChangedEventHandler, PropertyChangedEventArgs&gt;()
    <span style="color:blue;">member </span>c.PropertyChanged = propertyChanged.Publish
    <span style="color:blue;">member private </span>c.RaisePropertyChangedEvent(propertyName:string) =
        <span style="color:blue;">if </span>not(propertyName = <span style="color:blue;">null</span>) <span style="color:blue;">then
            let </span>e = <span style="color:blue;">new </span>PropertyChangedEventArgs(propertyName)
            <span style="color:blue;">let </span>i = c :&gt; INotifyPropertyChanged
            propertyChanged.Trigger(c, e)
    <span style="color:blue;">member </span>c.Add(o) =
        <span style="color:blue;">base</span>.Add(o)
        o.PropertyChanged.Add(<span style="color:blue;">fun </span>x <span style="color:blue;">-&gt; </span>c.RaisePropertyChangedEvent(<span style="color:maroon;">""</span>))</pre>
<p>The first one is used as a base for all the viewmodel entities in the application, the second one serves as the base for all the collections. They both define the customary <em>PropertyChanged</em> event. The latter adds itself as an observer to each object added to the collection so that, whenever one changes, it gets notified and can notify its own observers. Look at the <em>c.Add</em> method. A lot of repetitive code here, I would heed the advice of the comment on top if this were production code.</p>
<p>Each line in the csv file is represented as a ResultViewModel, hence the following:</p>
<pre class="code"><span style="color:blue;">type </span>ResultViewModel (d:DateTime, sLong, sShort, tStop) =
    <span style="color:blue;">inherit </span>ViewModelBase ()
    <span style="color:blue;">let mutable </span>date = d
    <span style="color:blue;">let mutable </span>stockLong = sLong
    <span style="color:blue;">let mutable </span>stockShort = sShort
    <span style="color:blue;">let mutable </span>trailingStop = tStop
    <span style="color:blue;">new </span>() = <span style="color:blue;">new </span>ResultViewModel(DateTime.Today, <span style="color:maroon;">""</span>, <span style="color:maroon;">""</span>, 0)
    <span style="color:blue;">member </span>r.Date <span style="color:blue;">with </span>get() = date
                       <span style="color:blue;">and </span>set newValue =
                            date &lt;- newValue
                            <span style="color:blue;">base</span>.RaisePropertyChangedEvent(<span style="color:maroon;">"Date"</span>)
    <span style="color:blue;">member </span>r.StockLong <span style="color:blue;">with </span>get() = stockLong
                       <span style="color:blue;">and </span>set newValue =
                            stockLong &lt;- newValue
                            <span style="color:blue;">base</span>.RaisePropertyChangedEvent(<span style="color:maroon;">"StockLong"</span>)
    <span style="color:blue;">member </span>r.StockShort <span style="color:blue;">with </span>get() = stockShort
                        <span style="color:blue;">and </span>set newValue =
                            stockShort &lt;- newValue
                            <span style="color:blue;">base</span>.RaisePropertyChangedEvent(<span style="color:maroon;">"StockShort"</span>)
    <span style="color:blue;">member </span>r.TrailingStop <span style="color:blue;">with </span>get() =
                                trailingStop
                          <span style="color:blue;">and </span>set newValue =
                                trailingStop &lt;- newValue
                                <span style="color:blue;">base</span>.RaisePropertyChangedEvent(<span style="color:maroon;">"TrailingStop"</span>)
    <span style="color:blue;">member </span>r.IsThereAnError = r.TrailingStop &lt; 0 || r.TrailingStop &gt; 100</pre>
<p>I need the empty constructor to be able to hook up to the DataGrid add-new capability. There might be an event I could use instead, but this is simple enough (even if a bit goofy).</p>
<p>The main view model class then looks like the following:</p>
<pre class="code"><span style="color:blue;">type </span>MainViewModel (fileName:string) <span style="color:blue;">as </span>self =
    <span style="color:blue;">inherit </span>ViewModelBase ()
    <span style="color:blue;">let mutable </span>results = <span style="color:blue;">new </span>ObservableCollectionWithChanges&lt;ResultViewModel&gt;()
    <span style="color:blue;">let </span>loadResults () =
        parseFile fileName
        |&gt; Array.iter (<span style="color:blue;">fun </span>(d,sl, ss, ts) <span style="color:blue;">-&gt;
                        </span>results.Add(<span style="color:blue;">new </span>ResultViewModel(d, sl, ss, ts)))
    <span style="color:blue;">do
        </span>loadResults ()
        results.CollectionChanged.Add(<span style="color:blue;">fun </span>e <span style="color:blue;">-&gt; </span>self.WriteResults())
        results.PropertyChanged.Add(<span style="color:blue;">fun </span>e <span style="color:blue;">-&gt; </span>self.WriteResults())
    <span style="color:blue;">member </span>m.Results <span style="color:blue;">with </span>get() = results
                     <span style="color:blue;">and </span>set newValue =
                        results &lt;- newValue
                        <span style="color:blue;">base</span>.RaisePropertyChangedEvent(<span style="color:maroon;">"Results"</span>)
    <span style="color:blue;">member </span>m.WriteResults () =
        <span style="color:blue;">let </span>rs = results
                 |&gt; Seq.map (<span style="color:blue;">fun </span>r <span style="color:blue;">-&gt; </span>r.Date, r.StockLong, r.StockShort, r.TrailingStop)
        <span style="color:blue;">let </span>thereAreErrors = results |&gt; Seq.exists (<span style="color:blue;">fun </span>r <span style="color:blue;">-&gt; </span>r.IsThereAnError)
        <span style="color:blue;">if </span>not thereAreErrors <span style="color:blue;">then
            </span>writeFile fileName rs</pre>
<p>Things here are more interesting. First of all, in the constructor I load the results calling my model (which I created in <a href="http://lucabolognese.wordpress.com/2010/03/13/tracking-spread-trades-in-f-and-hooking-up-xunit-and-fscheck-part-1/">Part I</a> of this series). I then subscribe to both the events fired by the collection of results. The former is triggered when an object is added/removed, the latter is triggered when an object changes one of its properties. When one of them fires, I simply write the new state back to the file. This allows me to get rid of Submit/Cancel buttons. What the user sees on the screen is synchronized with the disk at all times. The user doesn’t need to know about the file system.</p>
<p>If this were real, I would also implement an undo/redo mechanism. In such case, my reliance on object events might be unwise. I would probably route all the user changes through a command mechanism, so that they can be undo more easily.</p>
<p>That’s it for the modelview. The View itself is as follows:</p>
<pre class="code"><span style="color:blue;">&lt;</span><span style="color:#a31515;">Window </span><span style="color:red;">x</span><span style="color:blue;">:</span><span style="color:red;">Class</span><span style="color:blue;">="SpreadTradingWPF.MainWindow"
        </span><span style="color:red;">xmlns</span><span style="color:blue;">="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        </span><span style="color:red;">xmlns</span><span style="color:blue;">:</span><span style="color:red;">x</span><span style="color:blue;">="http://schemas.microsoft.com/winfx/2006/xaml"
        </span><span style="color:red;">xmlns</span><span style="color:blue;">:</span><span style="color:red;">spreadTrading</span><span style="color:blue;">="clr-namespace:SpreadTradingWPF"
        </span><span style="color:red;">Title</span><span style="color:blue;">="Spread Trading" </span><span style="color:red;">Height</span><span style="color:blue;">="350" </span><span style="color:red;">Width</span><span style="color:blue;">="525" </span><span style="color:red;">SizeToContent</span><span style="color:blue;">="WidthAndHeight"&gt;
        &lt;</span><span style="color:#a31515;">Window.Resources</span><span style="color:blue;">&gt;
            &lt;</span><span style="color:#a31515;">spreadTrading</span><span style="color:blue;">:</span><span style="color:#a31515;">DateToShortStringConverter </span><span style="color:red;">x</span><span style="color:blue;">:</span><span style="color:red;">Key</span><span style="color:blue;">="DateToShortStringC" /&gt;
            &lt;</span><span style="color:#a31515;">LinearGradientBrush </span><span style="color:red;">x</span><span style="color:blue;">:</span><span style="color:red;">Key</span><span style="color:blue;">="BlueLightGradientBrush" </span><span style="color:red;">StartPoint</span><span style="color:blue;">="0,0" </span><span style="color:red;">EndPoint</span><span style="color:blue;">="0,1"&gt;
                    &lt;</span><span style="color:#a31515;">GradientStop </span><span style="color:red;">Offset</span><span style="color:blue;">="0" </span><span style="color:red;">Color</span><span style="color:blue;">="#FFEAF3FF"/&gt;
                    &lt;</span><span style="color:#a31515;">GradientStop </span><span style="color:red;">Offset</span><span style="color:blue;">="0.654" </span><span style="color:red;">Color</span><span style="color:blue;">="#FFC0DEFF"/&gt;
                    &lt;</span><span style="color:#a31515;">GradientStop </span><span style="color:red;">Offset</span><span style="color:blue;">="1" </span><span style="color:red;">Color</span><span style="color:blue;">="#FFC0D9FB"/&gt;
            &lt;/</span><span style="color:#a31515;">LinearGradientBrush</span><span style="color:blue;">&gt;
            &lt;</span><span style="color:#a31515;">Style </span><span style="color:red;">TargetType</span><span style="color:blue;">="{</span><span style="color:#a31515;">x</span><span style="color:blue;">:</span><span style="color:#a31515;">Type </span><span style="color:red;">DataGrid</span><span style="color:blue;">}"&gt;
                &lt;</span><span style="color:#a31515;">Setter </span><span style="color:red;">Property</span><span style="color:blue;">="Margin" </span><span style="color:red;">Value</span><span style="color:blue;">="5" /&gt;
                &lt;</span><span style="color:#a31515;">Setter </span><span style="color:red;">Property</span><span style="color:blue;">="Background" </span><span style="color:red;">Value</span><span style="color:blue;">="{</span><span style="color:#a31515;">StaticResource </span><span style="color:red;">BlueLightGradientBrush</span><span style="color:blue;">}" /&gt;
                &lt;</span><span style="color:#a31515;">Setter </span><span style="color:red;">Property</span><span style="color:blue;">="BorderBrush" </span><span style="color:red;">Value</span><span style="color:blue;">="#FFA6CCF2" /&gt;
                &lt;</span><span style="color:#a31515;">Setter </span><span style="color:red;">Property</span><span style="color:blue;">="RowBackground" </span><span style="color:red;">Value</span><span style="color:blue;">="White" /&gt;
                &lt;</span><span style="color:#a31515;">Setter </span><span style="color:red;">Property</span><span style="color:blue;">="AlternatingRowBackground" </span><span style="color:red;">Value</span><span style="color:blue;">="#FDFFD0" /&gt;
                &lt;</span><span style="color:#a31515;">Setter </span><span style="color:red;">Property</span><span style="color:blue;">="HorizontalGridLinesBrush" </span><span style="color:red;">Value</span><span style="color:blue;">="Transparent" /&gt;
                &lt;</span><span style="color:#a31515;">Setter </span><span style="color:red;">Property</span><span style="color:blue;">="VerticalGridLinesBrush" </span><span style="color:red;">Value</span><span style="color:blue;">="#FFD3D0" /&gt;
                &lt;</span><span style="color:#a31515;">Setter </span><span style="color:red;">Property</span><span style="color:blue;">="RowHeaderWidth" </span><span style="color:red;">Value</span><span style="color:blue;">="20" /&gt;
            &lt;/</span><span style="color:#a31515;">Style</span><span style="color:blue;">&gt;
    &lt;/</span><span style="color:#a31515;">Window.Resources</span><span style="color:blue;">&gt;
        &lt;</span><span style="color:#a31515;">StackPanel </span><span style="color:red;">HorizontalAlignment</span><span style="color:blue;">="Center" </span><span style="color:red;">Name</span><span style="color:blue;">="stackPanel1" </span><span style="color:red;">VerticalAlignment</span><span style="color:blue;">="Top" </span><span style="color:red;">Margin</span><span style="color:blue;">="20"&gt;
            &lt;</span><span style="color:#a31515;">TextBlock </span><span style="color:red;">Text</span><span style="color:blue;">="Spread Trading" </span><span style="color:red;">Width</span><span style="color:blue;">="135" </span><span style="color:red;">HorizontalAlignment</span><span style="color:blue;">="Center" </span><span style="color:red;">FontSize</span><span style="color:blue;">="18" </span><span style="color:red;">FontWeight</span><span style="color:blue;">="Bold" </span><span style="color:red;">FontStretch</span><span style="color:blue;">="ExtraExpanded" /&gt;
            &lt;</span><span style="color:#a31515;">DataGrid </span><span style="color:red;">Height</span><span style="color:blue;">="Auto" </span><span style="color:red;">Width</span><span style="color:blue;">="Auto" </span><span style="color:red;">Margin</span><span style="color:blue;">="5" </span><span style="color:red;">ItemsSource</span><span style="color:blue;">="{</span><span style="color:#a31515;">Binding </span><span style="color:red;">Results</span><span style="color:blue;">}" </span><span style="color:red;">CanUserAddRows </span><span style="color:blue;">="True" </span><span style="color:red;">CanUserDeleteRows</span><span style="color:blue;">="True" </span><span style="color:red;">AutoGenerateColumns</span><span style="color:blue;">="False"&gt;
                &lt;</span><span style="color:#a31515;">DataGrid.RowValidationRules</span><span style="color:blue;">&gt;
                    &lt;</span><span style="color:#a31515;">spreadTrading</span><span style="color:blue;">:</span><span style="color:#a31515;">ResultValidationRule </span><span style="color:red;">ValidationStep</span><span style="color:blue;">="UpdatedValue"/&gt;
                &lt;/</span><span style="color:#a31515;">DataGrid.RowValidationRules</span><span style="color:blue;">&gt;
                &lt;</span><span style="color:#a31515;">DataGrid.RowValidationErrorTemplate</span><span style="color:blue;">&gt;
                    &lt;</span><span style="color:#a31515;">ControlTemplate</span><span style="color:blue;">&gt;
                        &lt;</span><span style="color:#a31515;">Grid </span><span style="color:red;">Margin</span><span style="color:blue;">="0,-2,0,-2"
                              </span><span style="color:red;">ToolTip</span><span style="color:blue;">="{</span><span style="color:#a31515;">Binding </span><span style="color:red;">RelativeSource</span><span style="color:blue;">={</span><span style="color:#a31515;">RelativeSource
                              </span><span style="color:red;">FindAncestor</span><span style="color:blue;">, </span><span style="color:red;">AncestorType</span><span style="color:blue;">={</span><span style="color:#a31515;">x</span><span style="color:blue;">:</span><span style="color:#a31515;">Type </span><span style="color:red;">DataGridRow</span><span style="color:blue;">}},
                              </span><span style="color:red;">Path</span><span style="color:blue;">=(Validation.Errors)[</span><span style="color:blue;">].ErrorContent}"&gt;
                            &lt;</span><span style="color:#a31515;">Ellipse </span><span style="color:red;">StrokeThickness</span><span style="color:blue;">="0" </span><span style="color:red;">Fill</span><span style="color:blue;">="Red"
                                </span><span style="color:red;">Width</span><span style="color:blue;">="{</span><span style="color:#a31515;">TemplateBinding </span><span style="color:red;">FontSize</span><span style="color:blue;">}"
                                </span><span style="color:red;">Height</span><span style="color:blue;">="{</span><span style="color:#a31515;">TemplateBinding </span><span style="color:red;">FontSize</span><span style="color:blue;">}" /&gt;
                            &lt;</span><span style="color:#a31515;">TextBlock </span><span style="color:red;">Text</span><span style="color:blue;">="!" </span><span style="color:red;">FontSize</span><span style="color:blue;">="{</span><span style="color:#a31515;">TemplateBinding </span><span style="color:red;">FontSize</span><span style="color:blue;">}"
                                </span><span style="color:red;">FontWeight</span><span style="color:blue;">="Bold" </span><span style="color:red;">Foreground</span><span style="color:blue;">="White"
                                </span><span style="color:red;">HorizontalAlignment</span><span style="color:blue;">="Center"  /&gt;
                        &lt;/</span><span style="color:#a31515;">Grid</span><span style="color:blue;">&gt;
                    &lt;/</span><span style="color:#a31515;">ControlTemplate</span><span style="color:blue;">&gt;
                &lt;/</span><span style="color:#a31515;">DataGrid.RowValidationErrorTemplate</span><span style="color:blue;">&gt;
            &lt;</span><span style="color:#a31515;">DataGrid.Columns</span><span style="color:blue;">&gt;
                    &lt;</span><span style="color:#a31515;">DataGridTextColumn </span><span style="color:red;">Header</span><span style="color:blue;">="Date" </span><span style="color:red;">Binding</span><span style="color:blue;">="{</span><span style="color:#a31515;">Binding </span><span style="color:red;">Date</span><span style="color:blue;">, </span><span style="color:red;">Converter</span><span style="color:blue;">= {</span><span style="color:#a31515;">StaticResource </span><span style="color:red;">DateToShortStringC</span><span style="color:blue;">}}"  </span><span style="color:red;">IsReadOnly</span><span style="color:blue;">="false"/&gt;
                    &lt;</span><span style="color:#a31515;">DataGridTextColumn </span><span style="color:red;">Header</span><span style="color:blue;">="Long" </span><span style="color:red;">Binding</span><span style="color:blue;">="{</span><span style="color:#a31515;">Binding </span><span style="color:red;">StockLong</span><span style="color:blue;">}"/&gt;
                    &lt;</span><span style="color:#a31515;">DataGridTextColumn </span><span style="color:red;">Header</span><span style="color:blue;">="Short" </span><span style="color:red;">Binding</span><span style="color:blue;">="{</span><span style="color:#a31515;">Binding </span><span style="color:red;">StockShort</span><span style="color:blue;">}" /&gt;
                    &lt;</span><span style="color:#a31515;">DataGridTextColumn </span><span style="color:red;">Header</span><span style="color:blue;">="Stop" </span><span style="color:red;">Binding</span><span style="color:blue;">="{</span><span style="color:#a31515;">Binding </span><span style="color:red;">TrailingStop</span><span style="color:blue;">}" /&gt;
            &lt;/</span><span style="color:#a31515;">DataGrid.Columns</span><span style="color:blue;">&gt;
            &lt;/</span><span style="color:#a31515;">DataGrid</span><span style="color:blue;">&gt;
        &lt;/</span><span style="color:#a31515;">StackPanel</span><span style="color:blue;">&gt;
&lt;/</span><span style="color:#a31515;">Window</span><span style="color:blue;">&gt;
</span></pre>
<p>Notice that I styled the grid and I used the right incantations to get validation errors and to bind things properly. The <em>DateToShortString</em> converter used for the date field might be mildly interesting. It’s in the <em>Utilities.cs</em> file together with a validation rule that just delegates to the <em>IsThereAnError</em> method on each entity. In a bigger application, you could write this code in a much more reusable way.</p>
<pre class="code">[<span style="color:#2b91af;">ValueConversion</span>(<span style="color:blue;">typeof </span>(<span style="color:#2b91af;">DateTime</span>), <span style="color:blue;">typeof </span>(<span style="color:blue;">string</span>))]
<span style="color:blue;">public class </span><span style="color:#2b91af;">DateToShortStringConverter </span>: <span style="color:#2b91af;">IValueConverter
</span>{
<span style="color:blue;">public </span><span style="color:#2b91af;">Object </span>Convert(
        <span style="color:#2b91af;">Object </span>value,
        <span style="color:#2b91af;">Type </span>targetType,
        <span style="color:#2b91af;">Object </span>parameter,
        <span style="color:#2b91af;">CultureInfo </span>culture)
{
    <span style="color:blue;">var </span>date = (<span style="color:#2b91af;">DateTime</span>) value;
    <span style="color:blue;">return </span>date.ToShortDateString();
}
<span style="color:blue;">public object </span>ConvertBack(
    <span style="color:blue;">object </span>value,
    <span style="color:#2b91af;">Type </span>targetType,
    <span style="color:blue;">object </span>parameter,
    <span style="color:#2b91af;">CultureInfo </span>culture)
    {
        <span style="color:blue;">string </span>strValue = value <span style="color:blue;">as string</span>;
        <span style="color:#2b91af;">DateTime </span>resultDateTime;
        <span style="color:blue;">if </span>(<span style="color:#2b91af;">DateTime</span>.TryParse(strValue, <span style="color:blue;">out </span>resultDateTime))
        {
            <span style="color:blue;">return </span>resultDateTime;
        }
        <span style="color:blue;">return </span><span style="color:#2b91af;">DependencyProperty</span>.UnsetValue;
    }
}
<span style="color:blue;">public class </span><span style="color:#2b91af;">ResultValidationRule </span>: <span style="color:#2b91af;">ValidationRule
</span>{
    <span style="color:blue;">public override </span><span style="color:#2b91af;">ValidationResult </span>Validate(<span style="color:blue;">object </span>value, <span style="color:#2b91af;">CultureInfo </span>cultureInfo)
    {
        <span style="color:blue;">var </span>result = (value <span style="color:blue;">as </span><span style="color:#2b91af;">BindingGroup</span>).Items[0] <span style="color:blue;">as </span><span style="color:#2b91af;">ResultViewModel</span>;
        <span style="color:blue;">if</span>(result.IsThereAnError)
            <span style="color:blue;">return new </span><span style="color:#2b91af;">ValidationResult</span>(<span style="color:blue;">false</span>, <span style="color:#a31515;">"TrailingStop must be between 0 and 100"</span>);
        <span style="color:blue;">else
            return </span><span style="color:#2b91af;">ValidationResult</span>.ValidResult;
    }
}</pre>
<p>After all these niceties, this is what you get.</p>
<p><a href="../../wp-content/uploads/2010/03/image.png"><img style="border-bottom:0;border-left:0;display:inline;border-top:0;border-right:0;" title="image" border="0" alt="image" src="../../wp-content/uploads/2010/03/image_thumb.png" width="244" height="219" /></a></p>



  
  <div id="disqus-container">
  
    <button id="disqus-button" onclick="showComments()">Show comments</button>
    <div id="disqus-comments">
      
      
      
        <div id="disqus_thread">
        </div>
        <script type="application/javascript">
          function showComments() {
            var disqus_config = function () {
};
// Build and append comments 
var d = document;
var s = d.createElement('script');
s.async = true;
s.src = '//' + "lucabol" + '.disqus.com/embed.js';
s.setAttribute('data-timestamp', + new Date());
(d.head || d.body).appendChild(s);
            // Remove button
var disqusButton = document.getElementById('disqus-button');
disqusButton.parentNode.removeChild(disqusButton); 
// Un-hide comments
var disqusComments = document.getElementById('disqus-comments');
disqusComments.style.display = 'block'; 
          }
        </script>
      
      <noscript>Enable JavaScript to view Disqus comments.</noscript>
    </div>
  
</div>




    </main>

    <aside id="sidebar-left">
        
<div id="tags">
  <header>
    <h1>Tags</h1>
      
    <h2>¶</h2>
    
  </header>
  
    
    <nav>
      <ul>
        
            <li><a href="../../MyBlog/tags/fsharp">fsharp</a></li>
        
            <li><a href="../../MyBlog/tags/financial">Financial</a></li>
        
      </ul>
    </nav>
    
  
</div>

    </aside>

    <aside id="sidebar-right">
        <section id="TOC">
        
  
    <header>
        <h1>Table of contents</h1>
        <h2>¶</h2>
    </header>
    


        </section>
    </aside>

    <a id="to_top" href="#top">Top</a>
    <footer>
        
    </footer>

    <script>
    const th = document.querySelector("#theme")
    th.addEventListener("click", e => {
        const x = document.querySelector(".dropdown-content")
        if (x.style.display === "block") {
            x.removeAttribute("style")
        } else {
            x.style.display = "block";
        }
    })
    const children = document.querySelectorAll(".font-name")
    const allStyles = Array.from(children).map(c => c.dataset.classname)

    const defaultStyle = "TimesNewRoman"
    const retrievedStyle = localStorage.getItem("Style")
    const style = allStyles.includes(retrievedStyle) ? retrievedStyle : defaultStyle
    document.body.className = style;

    const fontEl = document.querySelector(".dropdown-content")
    fontEl.addEventListener("click", e => {
        const el = e.target
        const style = el.dataset.classname
        document.body.className = style;
        localStorage.setItem("Style", style)
    })



</script>
    <script>
const init = () => {

    
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    
    window.ga = window.ga || ((...args) => (ga.q = ga.q || []).push(args));

    ga('create', 'UA-133194891-1', 'auto');
    ga('set', 'transport', 'beacon');
    ga('send', 'pageview');
};


window.addEventListener('load', init);
</script>
    <script>
    if("serviceWorker" in navigator){
        navigator.serviceWorker.register("/sw.js");
    }
</script>
    <script>
    window.addEventListener('offline', (e) => {
        const els = document.getElementsByClassName('offline')
        for(const el of els)
            el.classList.add("show")
        window.caches.keys().then(strikeNonCached)
    })
    window.addEventListener('online', (e) => {
        const els = document.getElementsByClassName('offline')
        for(const el of els)
            el.classList.remove("show")

        const as = document.querySelectorAll('main a')
        for(const a of as)
            a.classList.remove('strike')
    })

    const strikeNonCached = cacheKeys => {
        caches.open(cacheKeys[0]).then(cache =>
            cache.keys().then(keys => {
                const as = document.querySelectorAll('main a')
                const urls = keys.map(k => k.url)
                for(const a of as)
                    if(urls.indexOf(a.href) === -1)    
                        a.classList.add('strike')
    }))}

    if(navigator.onLine)
        window.dispatchEvent(new Event('online'))
    else
        window.dispatchEvent(new Event('offline'))

</script>
    <script>
function variableResize() {

  
  let bodyStyles = window.getComputedStyle(document.body);	
	
  let root = document.documentElement;
	
	
	const maxWindowSize = bodyStyles.getPropertyValue('--bp-xlarge') * 16;
	const minWindowSize = bodyStyles.getPropertyValue('--bp-small') * 16;
	
	
	const windowWidth = window.innerWidth
	
  
  const pWidthVar = '--p-wdth';
	const pMinFontWidth = bodyStyles.getPropertyValue('--p-wdth-min');
	const pMaxFontWidth = bodyStyles.getPropertyValue('--p-wdth-max');
	scale(pWidthVar, pMinFontWidth, pMaxFontWidth);

  const pWeightVar = '--p-wght';
	const pMinFontWeight = bodyStyles.getPropertyValue('--p-wght-min');
	const pMaxFontWeight = bodyStyles.getPropertyValue('--p-wght-max');
	scale(pWeightVar, pMinFontWeight, pMaxFontWeight);
	
  const h1WidthVar = '--h1-wdth';
	const h1MinFontWidth = bodyStyles.getPropertyValue('--h1-wdth-min');
	const h1MaxFontWidth = bodyStyles.getPropertyValue('--h1-wdth-max');
	scale(h1WidthVar, h1MinFontWidth, h1MaxFontWidth);

  const h1WeightVar = '--h1-wght';
	const h1MinFontWeight = bodyStyles.getPropertyValue('--h1-wght-min');
	const h1MaxFontWeight = bodyStyles.getPropertyValue('--h1-wght-max');
	scale(h1WeightVar, h1MinFontWeight, h1MaxFontWeight);
	
  const h2WidthVar = '--h2-wdth';
	const h2MinFontWidth = bodyStyles.getPropertyValue('--h2-wdth-min');
	const h2MaxFontWidth = bodyStyles.getPropertyValue('--h2-wdth-max');
	scale(h2WidthVar, h2MinFontWidth, h2MaxFontWidth);

  const h2WeightVar = '--h2-wght';
	const h2MinFontWeight = bodyStyles.getPropertyValue('--h2-wght-min');
	const h2MaxFontWeight = bodyStyles.getPropertyValue('--h2-wght-max');
	scale(h2WeightVar, h2MinFontWeight, h2MaxFontWeight);
	
	function scale(varName, minValue, maxValue) {
		
		minValue = minValue * 1;
		maxValue = maxValue * 1;

		
		const percent = (windowWidth - minWindowSize) / (maxWindowSize - minWindowSize);
		if (maxValue < minValue) {
			var valueScale = minValue - (percent * (minValue - maxValue));
		} else {
			var valueScale = (percent * (maxValue - minValue)) + minValue;
		}
	  
		
		const newValue = windowWidth > maxWindowSize
		   ? maxValue 
		   : windowWidth < minWindowSize 
				? minValue 
				: valueScale;
	   
		
		root.style.setProperty(varName, newValue);
	}
}

window.addEventListener("load", variableResize);
window.addEventListener("resize", variableResize);

</script>
    <script>
  const el = document.querySelector("#to_nav")
  el.addEventListener("click", e => {
    const x = document.querySelector("#primary_nav")
    if (x.style.display === "block") {
      x.removeAttribute("style")
    } else {
      x.style.display = "block";
    }
  })
  window.addEventListener('click', e => {
    const x = document.querySelector("#primary_nav")
    const y = document.querySelector("#to_nav")
    if (!y.contains(e.target) && x.style.display === "block") {
      x.removeAttribute("style")
    } 

    const th = document.querySelector("#theme")
    const x1 = document.querySelector(".dropdown-content")

    if (!th.contains(e.target) && ! x1.contains(e.target) && x1.style.display === "block") {
      x1.removeAttribute("style")
    } 
  })
</script>

</body>
</html>